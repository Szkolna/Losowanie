<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Losowanie na Mikołajki</title>
    <link rel="stylesheet" href="style.css" type="text/css">

    <!-- Dodanie Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <h1>Losowanie na Mikołajki</h1>
        <p>Wybierz swoje imię z listy i wciśnij przycisk, aby wylosować osobę na Mikołajki!</p>

        <select id="wybraneImie">
        </select>

        <button onclick="rozpocznijLosowanie()">Rozpocznij losowanie</button>

        <div id="wynik"></div>

        <div id="resetPanel">
            <h3>Reset losowania</h3>
            <input type="password" id="resetHaslo" placeholder="Wprowadź hasło">
            <button id="resetButton" onclick="zresetujLosowanie()">Resetuj losowanie</button>
        </div>
    </div>

    <script>
        // Konfiguracja Firebase
        const firebaseConfig = {
        apiKey: "AIzaSyCBk73qxxvTSsGJnGtRra7y6sm7YqrDkok",
        authDomain: "mikolajki-8e3b3.firebaseapp.com",
        projectId: "mikolajki-8e3b3",
        storageBucket: "mikolajki-8e3b3.firebasestorage.app",
        messagingSenderId: "139786940214",
        appId: "1:139786940214:web:b2d1abaf314d7d9cc44d97",
        measurementId: "G-H6QGJ16FPP"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Zainicjalizuj dane (tutaj będziemy wczytywać dane z Firebase)
        let dostepneImiona = [];

        // Wypełnianie listy imion w select
        function wypelnijListeImion() {
            const select = document.getElementById('wybraneImie');
            select.innerHTML = ''; // Czyścimy obecną listę
            dostepneImiona.forEach(imie => {
                const opcja = document.createElement('option');
                opcja.value = imie;
                opcja.textContent = imie;
                select.appendChild(opcja);
            });
        }

        // Losowanie
        async function rozpocznijLosowanie() {
            const wybraneImie = document.getElementById('wybraneImie').value;
            let wylosowaneImie = 'Inny uczestnik'; // przykładowe losowanie

            // Prosty algorytm losowania
            const pozostaliUczestnicy = dostepneImiona.filter(imie => imie !== wybraneImie);
            if (pozostaliUczestnicy.length === 0) {
                document.getElementById('wynik').textContent = 'Wszyscy zostali już wylosowani!';
                return;
            }

            const losowyIndex = Math.floor(Math.random() * pozostaliUczestnicy.length);
            wylosowaneImie = pozostaliUczestnicy[losowyIndex];

            document.getElementById('wynik').textContent = `Wylosowana osoba: ${wylosowaneImie}`;

            // Odśwież listę imion
            wypelnijListeImion();
        }

        // Resetowanie
        async function zresetujLosowanie() {
            const wprowadzoneHaslo = document.getElementById('resetHaslo').value;
            if (wprowadzoneHaslo === 'yourSecretPassword') {
                await db.collection("uczestnicy").get().then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        doc.ref.delete(); // Usuń wszystkie dokumenty
                    });
                });

                alert('Losowanie zostało zresetowane.');
                location.reload();
            } else {
                alert('Niepoprawne hasło!');
            }
        }

        // Pobieranie danych o uczestnikach z Firebase i wypełnianie listy
        async function pobierzUczestnikowZFirebase() {
            // Pobieramy dane z Firebase
            try {
                const snapshot = await db.collection('uczestnicy').get();
                console.log('Dane z Firebase:', snapshot.docs.map(doc => doc.id)); // Debugowanie: Zobacz, co mamy w Firebase

                // Pobierz wszystkie dostępne imiona
                dostepneImiona = snapshot.docs.map(doc => doc.id); // Przypisz imiona z Firebase
                console.log('Dostępne imiona:', dostepneImiona); // Debugowanie

                // Wypełnij listę imion
                wypelnijListeImion();
            } catch (error) {
                console.error('Błąd podczas pobierania danych z Firebase:', error);
            }
        }

        // Na początku pobierz uczestników z Firebase
        pobierzUczestnikowZFirebase();
    </script>
</body>
</html>
