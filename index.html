<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Losowanie na Mikołajki</title>
    <link rel="stylesheet" href="style.css" type="text/css">

    <!-- Dodanie Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <h1>Losowanie na Mikołajki</h1>
        <p>Wybierz swoje imię z listy i wciśnij przycisk, aby wylosować osobę na Mikołajki!</p>

        <select id="wybraneImie">
        </select>

        <button onclick="rozpocznijLosowanie()">Rozpocznij losowanie</button>

        <div id="wynik"></div>

        <div id="resetPanel">
            <h3>Reset losowania</h3>
            <input type="password" id="resetHaslo" placeholder="Wprowadź hasło">
            <button id="resetButton" onclick="zresetujLosowanie()">Resetuj losowanie</button>
        </div>
    </div>

    <script>
        // Konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Zainicjalizuj dane
        const uczestnicy = [
            'Jan Cuber', 'Oskar Faluszewski', 'Jakub Hemmerling', 'Maciej Iliaszuk', 'Michał Kamiński', 'Oleksandr Kasiian', 'Jan Kobrzak',
            'Tomasz Krasula', 'Mikołaj Leśkiewicz', 'Maciej Majewski', 'Bartosz Pastuszka', 'Jakub Mankiewicz', 'Wiktor Michalik', 'Jakub Pap', 'Patryk Piesio',
            'Julian Witold Szudy', 'Paweł Smogorzewski', 'Tomasz Sajdak', 'Jakub Woźniak', 'Andrei Svistunovich', 'Daniil Schepelin', 'Vadzim Vait', 'Jan Rozmanowski',
            'Stefan Sobkow', 'Jakub Szulc', 'Milena Zegan', 'Stanislav Priadko', 'Konstantyn Sivak', 'Yegor Tkachenko', 'Wanda Kroplewska'
        ];

        // Przechowywanie wyników na Firebase
        const wylosowani = [];
        let dostepneImiona = [...uczestnicy];

        // Wypełnianie listy imion w select
        function wypelnijListeImion() {
            const select = document.getElementById('wybraneImie');
            select.innerHTML = '';
            dostepneImiona.forEach(imie => {
                const opcja = document.createElement('option');
                opcja.value = imie;
                opcja.textContent = imie;
                select.appendChild(opcja);
            });
        }

        // Losowanie
        async function rozpocznijLosowanie() {
            const wybraneImie = document.getElementById('wybraneImie').value;

            if (wylosowani.includes(wybraneImie)) {
                document.getElementById('wynik').textContent = `Już dokonałeś losowania! Wylosowana osoba: ${wylosowani[wybraneImie]}`;
                return;
            }

            let wylosowaneImie;
            
            // Prosty algorytm losowania
            const pozostaliUczestnicy = dostepneImiona.filter(imie => !wylosowani.includes(imie) && imie !== wybraneImie);
            if (pozostaliUczestnicy.length === 0) {
                document.getElementById('wynik').textContent = 'Wszyscy zostali już wylosowani!';
                return;
            }

            const losowyIndex = Math.floor(Math.random() * pozostaliUczestnicy.length);
            wylosowaneImie = pozostaliUczestnicy[losowyIndex];

            // Zapisz wynik
            wylosowani.push(wylosowaneImie);

            // Zaktualizuj dostępne imiona na Firebase
            await db.collection("uczestnicy").doc(wybraneImie).set({ wylosowane: wylosowaneImie });

            document.getElementById('wynik').textContent = `Wylosowana osoba: ${wylosowaneImie}`;

            // Odśwież listę imion
            wypelnijListeImion();
        }

        // Resetowanie
        async function zresetujLosowanie() {
            const wprowadzoneHaslo = document.getElementById('resetHaslo').value;
            if (wprowadzoneHaslo === 'yourSecretPassword') {
                await db.collection("uczestnicy").get().then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        doc.ref.delete(); // Usuń wszystkie dokumenty
                    });
                });

                alert('Losowanie zostało zresetowane.');
                location.reload();
            } else {
                alert('Niepoprawne hasło!');
            }
        }

        // Pobieranie danych o uczestnikach z Firebase i wypełnianie listy
        async function pobierzUczestnikowZFirebase() {
            const snapshot = await db.collection('uczestnicy').get();
            snapshot.forEach(doc => {
                dostepneImiona = dostepneImiona.filter(imie => imie !== doc.id); // Usuwanie wylosowanych osób
            });
            wypelnijListeImion(); // Zaktualizuj listę
        }

        // Na początku pobierz uczestników z Firebase
        pobierzUczestnikowZFirebase();

    </script>
</body>
</html>
